In modernen Webanwendungen stellen OAuth-Sicherheitslücken ein ernstes und häufig unterschätztes Risiko dar. Wenn wir von OAuth sprechen, meinen wir OAuth 2.0, das häufig verwendete Autorisierungsframework. Die Sicherheitslücken entstehen, wenn Hacker Schwachstellen in OAuth 2.0 ausnutzen, wodurch CSRF, XSS, Datenlecks und die Ausnutzung anderer Sicherheitslücken möglich werden.

# Basis/Key Konzepte

Da es essentiell ist die grundlegenden Konzepte von 0Auth oder genauer 0Auth 2.0 zu verstehen um eine Seite zu PenTesten oder zu Programmieren, werden diese unterhalb anhand des Beispiels einer Handy App eines Coffeeshops erklärt, welche genutzt wird um Sachen zu Ordern und zu Bezahlen.

## Ressource Owner 
Der Resource Owner ist die Person oder das System, die bzw. das bestimmte Daten kontrolliert und einer Anwendung den Zugriff auf diese Daten in seinem Namen genehmigen kann. Dieses Konzept ist von grundlegender Bedeutung, da es sich um die Zustimmung und Kontrolle des Benutzers dreht. Als Kunde eines Cafés bist du beispielsweise der Resource Owner. Du kannst deine Kontoinformationen kontrollieren und der mobilen App des Cafés die Berechtigung zum Zugriff auf deine Daten erteilen.

## Client

Der Client kann eine mobile Anwendung oder eine serverseitige Webanwendung sein. Er fungiert als Vermittler, der den Zugriff auf Ressourcen anfordert und die vom Eigentümer der Ressource genehmigten Aktionen durchführt. Ein Beispiel: Die Webanwendung des Cafés, mit der du deinen Kaffee bestellst und bezahlst, ist der Client. Für den Zugriff auf die Konto- und Zahlungsdaten ist deine Autorisierung erforderlich.

## Authorization Server

Der Autorisierungsserver ist dafür zuständig, dem Client nach erfolgreicher Authentifizierung des Ressourcenbesitzers und Erhalt seiner Autorisierung Zugriffstoken auszustellen. Der Autorisierungsserver spielt eine entscheidende Rolle im OAuth-Prozess, indem er sicherstellt, dass dem Client erst nach legitimer Benutzerauthentifizierung und Zustimmung die Berechtigung erteilt wird. Beispielsweise ist das Backend-System des Cafés, das die Authentifizierung und Autorisierung übernimmt, der Autorisierungsserver. Es überprüft deine Anmeldedaten und erteilt der Web-App die Berechtigung, auf dein Konto zuzugreifen.

## Resource Server

Der Server, auf dem die geschützten Ressourcen gehostet werden, kann Anfragen nach geschützten Ressourcen mithilfe von Zugriffstoken akzeptieren und beantworten. Dieser Server stellt sicher, dass nur authentifizierte und autorisierte Clients auf die Daten des Ressourcenbesitzers zugreifen oder diese bearbeiten können. Der Ressourcenserver ist beispielsweise die Datenbank des Cafés, in der Ihre Kontoinformationen, Ihre Bestellhistorie und Ihre Zahlungsdetails gespeichert sind. Er beantwortet Anfragen der Web-App und ermöglicht ihr so, Ihre Daten abzurufen und zu ändern.

## Authorization Grant

Der Client verwendet eine Berechtigung, die die Autorisierung des Ressourcenbesitzers (für den Zugriff auf seine geschützten Ressourcen) darstellt, um ein Zugriffstoken zu erhalten. Die primären Berechtigungstypen sind Autorisierungscode, implizit, Anmeldedaten des Ressourcenbesitzers und Client-Anmeldedaten. Wenn Sie sich beispielsweise zum ersten Mal bei der App des Cafés anmelden, erhalten Sie eine Autorisierungsberechtigung (z. B. durch Eingabe Ihres Benutzernamens und Passworts). Die App verwendet diese Berechtigung, um ein Zugriffstoken vom Autorisierungsserver zu erhalten.

  
## Access Token
Eine Berechtigung, mit der der Client im Namen des Ressourcenbesitzers auf geschützte Ressourcen zugreifen kann. Sie hat eine begrenzte Lebensdauer und einen begrenzten Umfang. Zugriffstoken sind unerlässlich, um eine sichere und geschützte Kommunikation zwischen dem Client und dem Ressourcenserver aufrechtzuerhalten, ohne den Ressourcenbesitzer wiederholt nach Berechtigungen fragen zu müssen. Wenn Sie sich beispielsweise bei der App eines Cafés anmelden, erhält diese ein Zugriffstoken, mit dem die App auf Ihr Konto zugreifen kann, um Bestellungen aufzugeben und Zahlungen zu tätigen, ohne dass Sie sich für einen bestimmten Zeitraum erneut anmelden müssen.

## Refresh Token
Eine Berechtigung, mit der der Client ein neues Zugriffstoken erhalten kann, ohne dass sich der Ressourcenbesitzer erneut authentifizieren muss. Aktualisierungstoken sind in der Regel langlebig und bieten eine Möglichkeit, Benutzersitzungen ohne häufige Unterbrechungen durch Anmeldevorgänge aufrechtzuerhalten. Wenn beispielsweise Ihr Zugriffstoken abläuft, verwendet die Web-App ein Aktualisierungstoken, um ein neues Zugriffstoken zu erhalten, sodass Sie sich nicht erneut anmelden müssen.

## Redirect URI
Die URI, zu der der Autorisierungsserver den User-Agent des Ressourcenbesitzers nach der Gewährung oder Verweigerung der Autorisierung weiterleitet. Sie überprüft, ob der Client, für den die Autorisierungsantwort angefordert wurde, korrekt ist. Wenn Sie beispielsweise mit der Coffee-Shop-App interagieren und sich anmelden, werden Sie von der App-Seite in der Coffee-Shop-App, die allgemein als Weiterleitungs-URI bezeichnet wird, zum Autorisierungsserver weitergeleitet, um zu bestätigen, dass Sie sich erfolgreich angemeldet haben.

## Scope
Scopes sind ein Mechanismus, um den Zugriff einer Anwendung auf das Konto eines Benutzers zu beschränken. Sie ermöglichen es dem Client, die erforderliche Zugriffsebene festzulegen, und dem Autorisierungsserver, den Benutzer darüber zu informieren, welche Zugriffsebenen die Anwendung anfordert. Scopes helfen dabei, das Prinzip der geringsten Privilegien durchzusetzen. Beispielsweise kann die App des Cafés verschiedene Bereiche anfordern, wie z. B. Zugriff auf Ihre Bestellhistorie und Zahlungsdetails. Als Eigentümer der Ressource können Sie sehen, auf welche Informationen die App Zugriff anfordert, und Berechtigungen erteilen oder verweigern.

## State Parameter  

An **optional** parameter maintains the state between the client and the authorization server. It can help prevent CSRF attacks by ensuring the response matches the client's request. The state parameter is a crucial part of securing the OAuth flow. For example, when you initiate the login process, the coffee shop's app sends a state parameter to the authorization server. This parameter helps ensure that the response you receive is linked to your original request, protecting against certain types of attacks.

## Token & Authorization Endpoint

The authorization server's endpoint is where the client exchanges the authorization grant (or refresh token) for an access token. In contrast, the authorization endpoint is where the resource owner is authenticated and authorizes the client to access the protected resources.

# 0Auth Grant Types

OAuth 2.0 bietet mehrere Berechtigungstypen für verschiedene Szenarien und Client-Typen. Diese Berechtigungstypen legen fest, wie eine Anwendung ein Zugriffstoken erhalten kann, um im Namen des Ressourcenbesitzers auf geschützte Ressourcen zuzugreifen. In dieser Aufgabe werden wir vier primäre OAuth 2.0-Berechtigungstypen besprechen.

## Authorization Code Grant

The Authorization Code grant is the most commonly used OAuth 2.0 flow suited for server-side applications (PHP, JAVA, .NET etc). In this flow, the **client redirects the user to the authorization server, where the user authenticates and grants authorization**. The authorization server then redirects the user to the client with an **authorization code**. The client exchanges the authorization code for an access token by requesting the authorization server's token endpoint.

![[Pasted image 20260209170348.png]]